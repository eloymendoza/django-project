{% extends "mazer\base.html" %}


{% block title%}
Dashboard - Activate Directory
{% endblock title %}
{% block extra_css %}

<link rel="stylesheet" href="/static/assets/extensions/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="/static/assets/compiled/css/table-datatable-jquery.css">
<!-- Espacio para CSS adicional de plantillas hijas -->
{% endblock %}


{% block EncabezadoNav%}
Consulta
{% endblock EncabezadoNav %}


{% block EncabezadoCard%}
Consulta de los Usuarios
{% endblock EncabezadoCard %}

{% block contenido %}
    <div class="table-responsive ">     
       
        <table id="myTable" class="table table-hover table-striped">
            <thead>
                <tr>
                    <th>Acción</th>
                    <th>Nombre de Usuario </th>
                    <th>Nombre Completo </th>
                    <th>Correo Electrónico</th>
                    <th>Direccion</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userModal"
                        data-nombreCompleto ="{{ user.nombre_completo}}" 
                        data-nombre="{{ user.nombre }}"
                        data-email="{{ user.correo }}"
                        data-nombrePila ="{{ user.nombre_de_pila}}"
                        data-apellidos ="{{ user.apellidos}}"
                        data-departamento ="{{ user.departamento}}"
                        data-puesto ="{{ user.puesto }}"
                        data-nombreSesion ="{{ user.nombre_inicio_sesion}}"
                        data-nombreUsuarioPrincipal ="{{ user.usuario_principal }}"
                        onclick="showUserDetails(this);">
                        Ver Detalles
                        </button>
                    </td>
                    <td>{{ user.nombre }}</td>
                    <td>{{ user.nombre_completo}}</td>
                    <td>{{ user.correo }}</td>.
                    <td>{{ user.departamento}}</td>
                    
                </tr>
                {% endfor %}
            </tbody>
        </table> 

     



    </div>


    <div class="modal fade text-left" id="userModal" tabindex="-1" role="dialog"  aria-labelledby="myModalLabel4" data-bs-backdrop="false" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title" id="myModalLabel4">Detalles del Usuario</h4>
                                            <button type="button" class="close" data-bs-dismiss="modal"
                                                aria-label="Close">
                                                <i data-feather="x"></i>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                             <!-- Aquí van los detalles del usuario -->
                                             <div class="row align-content-center " >
                                                <div class="col-md-6">
                                                <p id="modalNombreCompleto"></p>  
                                                <p id="modalNombre"></p>
                                                <p id="modalEmail"></p>
                                                </div>
                                                <div class="col-md-6"> 
                                                <p id="modalNombreCompleto">ddd</p>  
                                                <p id="modalNombre">ddd</p>
                                                <p id="modalEmail">dddddd</p>
                                                </div>
                                            </div>
                                            <!-- Agrega más campos según sea necesario -->
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-light-secondary"
                                                data-bs-dismiss="modal">
                                                <i class="bx bx-x d-block d-sm-none"></i>
                                                <span class="d-none d-sm-block">Close</span>
                                            </button>
                                            <button type="button" class="btn btn-primary ms-1" data-bs-dismiss="modal">
                                                <i class="bx bx-check d-block d-sm-none"></i>
                                                <span class="d-none d-sm-block">Accept</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

    {% endblock %}

    {% block script %} 
    <script src="/static/assets/compiled/js/app.js"></script>
    <script src="/static/assets/extensions/jquery/jquery.min.js"></script>
    <script src="/static/assets/extensions/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="/static/assets/extensions/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
    <script src="/static/assets/static/js/pages/datatables.js"></script>
    <script>
        $(document).ready( function () {
            $('#myTable').DataTable({
                "pageLength": 10,
                "language": {
                    "lengthMenu": "Mostrar _MENU_ registros por página",
                    "zeroRecords": "No se encontraron resultados",
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "No hay registros disponibles",
                    "infoFiltered": "(filtrado de _MAX_ registros totales)",
                    "search": "Buscar:",
                    "paginate": {
                        "first":      "Primero",
                        "last":       "Último",
                        "next":       "Siguiente",
                        "previous":   "Anterior"
                    },
                    "loadingRecords": "Cargando...",
                    "processing":     "Procesando...",
                    "emptyTable":     "No hay datos disponibles en la tabla",
                    "aria": {
                        "sortAscending":  ": activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": activar para ordenar la columna de manera descendente"
                    }
                }
            });
        });
      
            function showUserDetails(button) {
                // Utiliza data attributes para obtener la información
                var nombreCompleto = button.getAttribute('data-nombreCompleto');
                var nombre = button.getAttribute('data-nombre');
                var email = button.getAttribute('data-email');
                var nombrePila = button.getAttribute('data-nombrePila');
                var apellidos = button.getAttribute('data-apellidos');


                // ... obtén otros datos usando data attributes
        
                // Rellena los datos en el modal
                document.getElementById("modalNombreCompleto").innerText = "Nombre: " + nombreCompleto;
                document.getElementById("modalNombre").innerText = "Usuario : " + nombre;
                document.getElementById("modalEmail").innerText = "Email: " + email;

                
                // ... rellena otros campos del modal
        
                // Abre el modal
                var modal = new bootstrap.Modal(document.getElementById('userModal'));
                modal.show();
            }
        
            // Esperar a que el DOM se cargue completamente
            document.addEventListener("DOMContentLoaded", function() {
                // Obtener el elemento del modal por su ID
                var userModal = document.getElementById('userModal');
        
                // Listener para el evento 'hidden.bs.modal', que se dispara después de que el modal se ha cerrado
                userModal.addEventListener('hidden.bs.modal', function () {
                    // Refrescar la página
                    location.reload();
                });
            });
        </script>
    {% endblock%}